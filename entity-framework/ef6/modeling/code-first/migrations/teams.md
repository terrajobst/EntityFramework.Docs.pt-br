---
title: Migrações do Code First em ambientes de equipe-EF6
author: divega
ms.date: 10/23/2016
ms.assetid: 4c2d9a95-de6f-4e97-9738-c1f8043eff69
ms.openlocfilehash: b3c4c35d636caf4ddd251dd78e026587abc57d42
ms.sourcegitcommit: cc0ff36e46e9ed3527638f7208000e8521faef2e
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 03/06/2020
ms.locfileid: "78418885"
---
# <a name="code-first-migrations-in-team-environments"></a><span data-ttu-id="7bf11-102">Migrações do Code First em ambientes de equipe</span><span class="sxs-lookup"><span data-stu-id="7bf11-102">Code First Migrations in Team Environments</span></span>
> [!NOTE]
> <span data-ttu-id="7bf11-103">Este artigo pressupõe que você saiba como usar Migrações do Code First em cenários básicos.</span><span class="sxs-lookup"><span data-stu-id="7bf11-103">This article assumes you know how to use Code First Migrations in basic scenarios.</span></span> <span data-ttu-id="7bf11-104">Caso contrário, você precisará ler [migrações do Code First](~/ef6/modeling/code-first/migrations/index.md) antes de continuar.</span><span class="sxs-lookup"><span data-stu-id="7bf11-104">If you don’t, then you’ll need to read [Code First Migrations](~/ef6/modeling/code-first/migrations/index.md) before continuing.</span></span>

## <a name="grab-a-coffee-you-need-to-read-this-whole-article"></a><span data-ttu-id="7bf11-105">Pegue um café, você precisa ler este artigo inteiro</span><span class="sxs-lookup"><span data-stu-id="7bf11-105">Grab a coffee, you need to read this whole article</span></span>

<span data-ttu-id="7bf11-106">Os problemas em ambientes de equipe estão em grande parte da mesclagem de migrações quando dois desenvolvedores geraram migrações em sua base de código local.</span><span class="sxs-lookup"><span data-stu-id="7bf11-106">The issues in team environments are mostly around merging migrations when two developers have generated migrations in their local code base.</span></span> <span data-ttu-id="7bf11-107">Embora as etapas para solucioná-las sejam bem simples, elas exigem uma compreensão sólida de como as migrações funcionam.</span><span class="sxs-lookup"><span data-stu-id="7bf11-107">While the steps to solve these are pretty simple, they require you to have a solid understanding of how migrations works.</span></span> <span data-ttu-id="7bf11-108">Não pule até o final – Reserve um tempo para ler o artigo inteiro para garantir que você tenha êxito.</span><span class="sxs-lookup"><span data-stu-id="7bf11-108">Please don’t just skip ahead to the end – take the time to read the whole article to ensure you are successful.</span></span>

## <a name="some-general-guidelines"></a><span data-ttu-id="7bf11-109">Algumas diretrizes gerais</span><span class="sxs-lookup"><span data-stu-id="7bf11-109">Some general guidelines</span></span>

<span data-ttu-id="7bf11-110">Antes de nos aprofundarmos em como gerenciar as migrações de mesclagem geradas por vários desenvolvedores, aqui estão algumas diretrizes gerais para configurá-lo para o sucesso.</span><span class="sxs-lookup"><span data-stu-id="7bf11-110">Before we dig into how to manage merging migrations generated by multiple developers, here are some general guidelines to set you up for success.</span></span>

### <a name="each-team-member-should-have-a-local-development-database"></a><span data-ttu-id="7bf11-111">Cada membro da equipe deve ter um banco de dados de desenvolvimento local</span><span class="sxs-lookup"><span data-stu-id="7bf11-111">Each team member should have a local development database</span></span>

<span data-ttu-id="7bf11-112">As migrações usam o **\_\_tabela MigrationsHistory** para armazenar quais migrações foram aplicadas ao banco de dados.</span><span class="sxs-lookup"><span data-stu-id="7bf11-112">Migrations uses the **\_\_MigrationsHistory** table to store what migrations have been applied to the database.</span></span> <span data-ttu-id="7bf11-113">Se você tiver vários desenvolvedores gerando diferentes migrações ao tentar direcionar o mesmo banco de dados (e, portanto, compartilhar um **\_\_tabela MigrationsHistory** ), o ficará muito confuso.</span><span class="sxs-lookup"><span data-stu-id="7bf11-113">If you have multiple developers generating different migrations while trying to target the same database (and thus share a **\_\_MigrationsHistory** table) migrations is going to get very confused.</span></span>

<span data-ttu-id="7bf11-114">É claro que, se você tiver membros da equipe que não estão gerando migrações, não há nenhum problema em compartilhar um banco de dados de desenvolvimento central.</span><span class="sxs-lookup"><span data-stu-id="7bf11-114">Of course, if you have team members that aren’t generating migrations, there is no problem having them share a central development database.</span></span>

### <a name="avoid-automatic-migrations"></a><span data-ttu-id="7bf11-115">Evitar migrações automáticas</span><span class="sxs-lookup"><span data-stu-id="7bf11-115">Avoid automatic migrations</span></span>

<span data-ttu-id="7bf11-116">O resultado final é que as migrações automáticas parecem ser boas inicialmente em ambientes de equipe, mas, na realidade, elas simplesmente não funcionam.</span><span class="sxs-lookup"><span data-stu-id="7bf11-116">The bottom line is that automatic migrations initially look good in team environments, but in reality they just don’t work.</span></span> <span data-ttu-id="7bf11-117">Se você quiser saber por que, continue lendo – caso contrário, poderá pular para a próxima seção.</span><span class="sxs-lookup"><span data-stu-id="7bf11-117">If you want to know why, keep reading – if not, then you can skip to the next section.</span></span>

<span data-ttu-id="7bf11-118">As migrações automáticas permitem que você tenha seu esquema de banco de dados atualizado para corresponder ao modelo atual sem a necessidade de gerar arquivos de código (migrações baseadas em código).</span><span class="sxs-lookup"><span data-stu-id="7bf11-118">Automatic migrations allows you to have your database schema updated to match the current model without the need to generate code files (code-based migrations).</span></span> <span data-ttu-id="7bf11-119">As migrações automáticas funcionariam muito bem em um ambiente de equipe se você as utilizou apenas e nunca geraram nenhuma migração baseada em código.</span><span class="sxs-lookup"><span data-stu-id="7bf11-119">Automatic migrations would work very well in a team environment if you only ever used them and never generated any code-based migrations.</span></span> <span data-ttu-id="7bf11-120">O problema é que as migrações automáticas são limitadas e não lidam com várias operações – renomeações de propriedade/coluna, movimentação de dados para outra tabela, etc. Para lidar com esses cenários, você acaba gerando migrações baseadas em código (e editando o código com scaffold) que são misturadas entre as alterações que são manipuladas por migrações automáticas.</span><span class="sxs-lookup"><span data-stu-id="7bf11-120">The problem is that automatic migrations are limited and don’t handle a number of operations – property/column renames, moving data to another table, etc. To handle these scenarios you end up generating code-based migrations (and editing the scaffolded code) that are mixed in between changes that are handled by automatic migrations.</span></span> <span data-ttu-id="7bf11-121">Isso o torna quase impossível de mesclar alterações quando dois desenvolvedores verificam as migrações.</span><span class="sxs-lookup"><span data-stu-id="7bf11-121">This makes it near on impossible to merge changes when two developers check in migrations.</span></span>

## <a name="screencasts"></a><span data-ttu-id="7bf11-122">Screencasts</span><span class="sxs-lookup"><span data-stu-id="7bf11-122">Screencasts</span></span>

<span data-ttu-id="7bf11-123">Se você preferir assistir a um screencast do que ler este artigo, os dois vídeos a seguir abrangem o mesmo conteúdo deste artigo.</span><span class="sxs-lookup"><span data-stu-id="7bf11-123">If you'd rather watch a screencast than read this article, the following two videos cover the same content as this article.</span></span>

### <a name="video-one-migrations---under-the-hood"></a><span data-ttu-id="7bf11-124">Vídeo um: "migrações-nos bastidores"</span><span class="sxs-lookup"><span data-stu-id="7bf11-124">Video One: "Migrations - Under the Hood"</span></span>

<span data-ttu-id="7bf11-125">[Este screencast](https://channel9.msdn.com/blogs/ef/migrations-under-the-hood) aborda como as migrações acompanham e usam informações sobre o modelo para detectar alterações de modelo.</span><span class="sxs-lookup"><span data-stu-id="7bf11-125">[This screencast](https://channel9.msdn.com/blogs/ef/migrations-under-the-hood) covers how migrations tracks and uses information about the model to detect model changes.</span></span>

### <a name="video-two-migrations---team-environments"></a><span data-ttu-id="7bf11-126">Vídeo dois: "migrações-ambientes de equipe"</span><span class="sxs-lookup"><span data-stu-id="7bf11-126">Video Two: "Migrations - Team Environments"</span></span>

<span data-ttu-id="7bf11-127">Aproveitando os conceitos do vídeo anterior, [Este screencast](https://channel9.msdn.com/blogs/ef/migrations-team-environments) aborda os problemas que surgem em um ambiente de equipe e como resolvê-los.</span><span class="sxs-lookup"><span data-stu-id="7bf11-127">Building on the concepts from the previous video, [this screencast](https://channel9.msdn.com/blogs/ef/migrations-team-environments) covers the issues that arise in a team environment and how to solve them.</span></span>

## <a name="understanding-how-migrations-works"></a><span data-ttu-id="7bf11-128">Compreendendo como funcionam as migrações</span><span class="sxs-lookup"><span data-stu-id="7bf11-128">Understanding how migrations works</span></span>

<span data-ttu-id="7bf11-129">A chave para o uso bem-sucedido de migrações em um ambiente de equipe é uma compreensão básica de como as migrações acompanham e usam informações sobre o modelo para detectar alterações no modelo.</span><span class="sxs-lookup"><span data-stu-id="7bf11-129">The key to successfully using migrations in a team environment is a basic understanding how migrations tracks and uses information about the model to detect model changes.</span></span>

### <a name="the-first-migration"></a><span data-ttu-id="7bf11-130">A primeira migração</span><span class="sxs-lookup"><span data-stu-id="7bf11-130">The first migration</span></span>

<span data-ttu-id="7bf11-131">Ao adicionar a primeira migração ao seu projeto, você executa algo como **Add-Migration primeiro** no console do Gerenciador de pacotes.</span><span class="sxs-lookup"><span data-stu-id="7bf11-131">When you add the first migration to your project, you run something like **Add-Migration First** in Package Manager Console.</span></span> <span data-ttu-id="7bf11-132">As etapas de alto nível que esse comando executa estão configuradas abaixo.</span><span class="sxs-lookup"><span data-stu-id="7bf11-132">The high level steps that this command performs are pictured below.</span></span>

![Primeira migração](~/ef6/media/firstmigration.png)

<span data-ttu-id="7bf11-134">O modelo atual é calculado a partir do seu código (1).</span><span class="sxs-lookup"><span data-stu-id="7bf11-134">The current model is calculated from your code (1).</span></span> <span data-ttu-id="7bf11-135">Os objetos de banco de dados necessários são então calculados pelo modelo de diferença (2) – já que essa é a primeira migração que o modelo difere apenas usa um modelo vazio para a comparação.</span><span class="sxs-lookup"><span data-stu-id="7bf11-135">The required database objects are then calculated by the model differ (2) – since this is the first migration the model differ just uses an empty model for the comparison.</span></span> <span data-ttu-id="7bf11-136">As alterações necessárias são passadas para o gerador de código para criar o código de migração necessário (3), que é então adicionado à sua solução do Visual Studio (4).</span><span class="sxs-lookup"><span data-stu-id="7bf11-136">The required changes are passed to the code generator to build the required migration code (3) which is then added to your Visual Studio solution (4).</span></span>

<span data-ttu-id="7bf11-137">Além do código de migração real que é armazenado no arquivo de código principal, as migrações também geram alguns arquivos code-behind adicionais.</span><span class="sxs-lookup"><span data-stu-id="7bf11-137">In addition to the actual migration code that is stored in the main code file, migrations also generates some additional code-behind files.</span></span> <span data-ttu-id="7bf11-138">Esses arquivos são metadados usados por migrações e não são algo que você deve editar.</span><span class="sxs-lookup"><span data-stu-id="7bf11-138">These files are metadata that is used by migrations and are not something you should edit.</span></span> <span data-ttu-id="7bf11-139">Um desses arquivos é um arquivo de recurso (. resx) que contém um instantâneo do modelo no momento em que a migração foi gerada.</span><span class="sxs-lookup"><span data-stu-id="7bf11-139">One of these files is a resource file (.resx) that contains a snapshot of the model at the time the migration was generated.</span></span> <span data-ttu-id="7bf11-140">Você verá como isso é usado na próxima etapa.</span><span class="sxs-lookup"><span data-stu-id="7bf11-140">You’ll see how this is used in the next step.</span></span>

<span data-ttu-id="7bf11-141">Neste ponto, você provavelmente executaria **Update-Database** para aplicar suas alterações ao banco de dados e, em seguida, implementar outras áreas do seu aplicativo.</span><span class="sxs-lookup"><span data-stu-id="7bf11-141">At this point you would probably run **Update-Database** to apply your changes to the database, and then go about implementing other areas of your application.</span></span>

### <a name="subsequent-migrations"></a><span data-ttu-id="7bf11-142">Migrações subsequentes</span><span class="sxs-lookup"><span data-stu-id="7bf11-142">Subsequent migrations</span></span>

<span data-ttu-id="7bf11-143">Mais tarde, você voltará e fará algumas alterações em seu modelo – em nosso exemplo, adicionaremos uma propriedade de **URL** ao **blog**.</span><span class="sxs-lookup"><span data-stu-id="7bf11-143">Later you come back and make some changes to your model – in our example we’ll add a **Url** property to **Blog**.</span></span> <span data-ttu-id="7bf11-144">Em seguida, você emitiria um comando como **Add-Migration addurl** para Scaffold uma migração para aplicar as alterações de banco de dados correspondentes.</span><span class="sxs-lookup"><span data-stu-id="7bf11-144">You would then issue a command such as **Add-Migration AddUrl** to scaffold a migration to apply the corresponding database changes.</span></span> <span data-ttu-id="7bf11-145">As etapas de alto nível que esse comando executa estão configuradas abaixo.</span><span class="sxs-lookup"><span data-stu-id="7bf11-145">The high level steps that this command performs are pictured below.</span></span>

![Segunda migração](~/ef6/media/secondmigration.png)

<span data-ttu-id="7bf11-147">Assim como na última vez, o modelo atual é calculado a partir do código (1).</span><span class="sxs-lookup"><span data-stu-id="7bf11-147">Just like last time, the current model is calculated from code (1).</span></span> <span data-ttu-id="7bf11-148">No entanto, desta vez há migrações existentes para que o modelo anterior seja recuperado da migração mais recente (2).</span><span class="sxs-lookup"><span data-stu-id="7bf11-148">However, this time there are existing migrations so the previous model is retrieved from the latest migration (2).</span></span> <span data-ttu-id="7bf11-149">Esses dois modelos são diferenciados para localizar as alterações de banco de dados necessárias (3) e, em seguida, o processo é concluído como antes.</span><span class="sxs-lookup"><span data-stu-id="7bf11-149">These two models are diffed to find the required database changes (3) and then the process completes as before.</span></span>

<span data-ttu-id="7bf11-150">Esse mesmo processo é usado para outras migrações que você adicionar ao projeto.</span><span class="sxs-lookup"><span data-stu-id="7bf11-150">This same process is used for any further migrations that you add to the project.</span></span>

### <a name="why-bother-with-the-model-snapshot"></a><span data-ttu-id="7bf11-151">Por que se preocupar com o instantâneo do modelo?</span><span class="sxs-lookup"><span data-stu-id="7bf11-151">Why bother with the model snapshot?</span></span>

<span data-ttu-id="7bf11-152">Você deve estar se perguntando por que o EF nos dois com o instantâneo do modelo – por que não apenas examinar o banco de dados.</span><span class="sxs-lookup"><span data-stu-id="7bf11-152">You may be wondering why EF bothers with the model snapshot – why not just look at the database.</span></span> <span data-ttu-id="7bf11-153">Em caso afirmativo, continue lendo.</span><span class="sxs-lookup"><span data-stu-id="7bf11-153">If so, read on.</span></span> <span data-ttu-id="7bf11-154">Se você não estiver interessado, poderá ignorar esta seção.</span><span class="sxs-lookup"><span data-stu-id="7bf11-154">If you’re not interested then you can skip this section.</span></span>

<span data-ttu-id="7bf11-155">Há vários motivos pelos quais o EF mantém o instantâneo do modelo:</span><span class="sxs-lookup"><span data-stu-id="7bf11-155">There are a number of reasons EF keeps the model snapshot around:</span></span>

-   <span data-ttu-id="7bf11-156">Ele permite que seu banco de dados seja descompasso do modelo do EF.</span><span class="sxs-lookup"><span data-stu-id="7bf11-156">It allows your database to drift from the EF model.</span></span> <span data-ttu-id="7bf11-157">Essas alterações podem ser feitas diretamente no banco de dados ou você pode alterar o código com Scaffold em suas migrações para fazer as alterações.</span><span class="sxs-lookup"><span data-stu-id="7bf11-157">These changes can be made directly in the database, or you can change the scaffolded code in your migrations to make the changes.</span></span> <span data-ttu-id="7bf11-158">Aqui estão alguns exemplos disso na prática:</span><span class="sxs-lookup"><span data-stu-id="7bf11-158">Here are a couple of examples of this in practice:</span></span>
    -   <span data-ttu-id="7bf11-159">Você deseja adicionar uma coluna inserted e Updated to a uma ou mais de suas tabelas, mas não deseja incluir essas colunas no modelo do EF.</span><span class="sxs-lookup"><span data-stu-id="7bf11-159">You want to add an Inserted and Updated to column to one or more of your tables but you don’t want to include these columns in the EF model.</span></span> <span data-ttu-id="7bf11-160">Se as migrações tiverem examinado o banco de dados, ele tentaria continuamente descartar essas colunas toda vez que você com Scaffold uma migração.</span><span class="sxs-lookup"><span data-stu-id="7bf11-160">If migrations looked at the database it would continually try to drop these columns every time you scaffolded a migration.</span></span> <span data-ttu-id="7bf11-161">Usando o instantâneo do modelo, o EF nunca detectará apenas alterações legítimas no modelo.</span><span class="sxs-lookup"><span data-stu-id="7bf11-161">Using the model snapshot, EF will only ever detect legitimate changes to the model.</span></span>
    -   <span data-ttu-id="7bf11-162">Você deseja alterar o corpo de um procedimento armazenado usado para que as atualizações incluam algum log.</span><span class="sxs-lookup"><span data-stu-id="7bf11-162">You want to change the body of a stored procedure used for updates to include some logging.</span></span> <span data-ttu-id="7bf11-163">Se as migrações examinarem esse procedimento armazenado do banco de dados, ele tentaria continuamente e redefini-lo de volta para a definição esperada pelo EF.</span><span class="sxs-lookup"><span data-stu-id="7bf11-163">If migrations looked at this stored procedure from the database it would continually try and reset it back to the definition that EF expects.</span></span> <span data-ttu-id="7bf11-164">Usando o instantâneo do modelo, o EF apenas Scaffold código para alterar o procedimento armazenado quando você altera a forma do procedimento no modelo do EF.</span><span class="sxs-lookup"><span data-stu-id="7bf11-164">By using the model snapshot, EF will only ever scaffold code to alter the stored procedure when you change the shape of the procedure in the EF model.</span></span>
    -   <span data-ttu-id="7bf11-165">Esses mesmos princípios se aplicam à adição de índices extras, incluindo tabelas extras em seu banco de dados, mapeando o EF para uma exibição de banco de dados que fica em uma tabela, etc.</span><span class="sxs-lookup"><span data-stu-id="7bf11-165">These same principles apply to adding extra indexes, including extra tables in your database, mapping EF to a database view that sits over a table, etc.</span></span>
-   <span data-ttu-id="7bf11-166">O modelo do EF contém mais do que apenas a forma do banco de dados.</span><span class="sxs-lookup"><span data-stu-id="7bf11-166">The EF model contains more than just the shape of the database.</span></span> <span data-ttu-id="7bf11-167">Ter todo o modelo permite que as migrações examinem as informações sobre as propriedades e as classes em seu modelo e como elas são mapeadas para as colunas e tabelas.</span><span class="sxs-lookup"><span data-stu-id="7bf11-167">Having the entire model allows migrations to look at information about the properties and classes in your model and how they map to the columns and tables.</span></span> <span data-ttu-id="7bf11-168">Essas informações permitem que as migrações sejam mais inteligentes no código que aplica Scaffold.</span><span class="sxs-lookup"><span data-stu-id="7bf11-168">This information allows migrations to be more intelligent in the code that it scaffolds.</span></span> <span data-ttu-id="7bf11-169">Por exemplo, se você alterar o nome da coluna que uma propriedade mapeia para migrações pode detectar a renomeação, vendo que é a mesma propriedade – algo que não pode ser feito se você tiver apenas o esquema de banco de dados.</span><span class="sxs-lookup"><span data-stu-id="7bf11-169">For example, if you change the name of the column that a property maps to migrations can detect the rename by seeing that it’s the same property – something that can’t be done if you only have the database schema.</span></span> 

## <a name="what-causes-issues-in-team-environments"></a><span data-ttu-id="7bf11-170">O que causa problemas em ambientes de equipe</span><span class="sxs-lookup"><span data-stu-id="7bf11-170">What causes issues in team environments</span></span>

<span data-ttu-id="7bf11-171">O fluxo de trabalho abordado na seção anterior funciona muito bem quando você é um único desenvolvedor trabalhando em um aplicativo.</span><span class="sxs-lookup"><span data-stu-id="7bf11-171">The workflow covered in the previous section works great when you are a single developer working on an application.</span></span> <span data-ttu-id="7bf11-172">Ele também funciona bem em um ambiente de equipe se você for a única pessoa fazendo alterações no modelo.</span><span class="sxs-lookup"><span data-stu-id="7bf11-172">It also works well in a team environment if you are the only person making changes to the model.</span></span> <span data-ttu-id="7bf11-173">Nesse cenário, você pode fazer alterações no modelo, gerar migrações e enviá-las ao controle do código-fonte.</span><span class="sxs-lookup"><span data-stu-id="7bf11-173">In this scenario you can make model changes, generate migrations and submit them to your source control.</span></span> <span data-ttu-id="7bf11-174">Outros desenvolvedores podem sincronizar suas alterações e executar **Update-Database** para que as alterações de esquema sejam aplicadas.</span><span class="sxs-lookup"><span data-stu-id="7bf11-174">Other developers can sync your changes and run **Update-Database** to have the schema changes applied.</span></span>

<span data-ttu-id="7bf11-175">Os problemas começam a surgir quando você tem vários desenvolvedores fazendo alterações no modelo do EF e enviando ao controle do código-fonte ao mesmo tempo.</span><span class="sxs-lookup"><span data-stu-id="7bf11-175">Issues start to arise when you have multiple developers making changes to the EF model and submitting to source control at the same time.</span></span> <span data-ttu-id="7bf11-176">O que o EF não tem é uma forma de primeira classe de mesclar suas migrações locais com migrações que outro desenvolvedor enviou ao controle do código-fonte desde a última sincronização.</span><span class="sxs-lookup"><span data-stu-id="7bf11-176">What EF lacks is a first class way to merge your local migrations with migrations that another developer has submitted to source control since you last synced.</span></span>

## <a name="an-example-of-a-merge-conflict"></a><span data-ttu-id="7bf11-177">Um exemplo de um conflito de mesclagem</span><span class="sxs-lookup"><span data-stu-id="7bf11-177">An example of a merge conflict</span></span>

<span data-ttu-id="7bf11-178">Primeiro, vamos dar uma olhada em um exemplo concreto desse conflito de mesclagem.</span><span class="sxs-lookup"><span data-stu-id="7bf11-178">First let’s look at a concrete example of such a merge conflict.</span></span> <span data-ttu-id="7bf11-179">Continuaremos com o exemplo que vimos anteriormente.</span><span class="sxs-lookup"><span data-stu-id="7bf11-179">We’ll continue on with the example we looked at earlier.</span></span> <span data-ttu-id="7bf11-180">Como ponto de partida, vamos supor que as alterações da seção anterior foram verificadas pelo desenvolvedor original.</span><span class="sxs-lookup"><span data-stu-id="7bf11-180">As a starting point let’s assume the changes from the previous section were checked in by the original developer.</span></span> <span data-ttu-id="7bf11-181">Acompanharemos dois desenvolvedores à medida que fizerem alterações na base de código.</span><span class="sxs-lookup"><span data-stu-id="7bf11-181">We’ll track two developers as they make changes to code base.</span></span>

<span data-ttu-id="7bf11-182">Acompanharemos o modelo do EF e as migrações por meio de várias alterações.</span><span class="sxs-lookup"><span data-stu-id="7bf11-182">We’ll track the EF model and the migrations thru a number of changes.</span></span> <span data-ttu-id="7bf11-183">Para um ponto de partida, ambos os desenvolvedores sincronizaram com o repositório de controle do código-fonte, conforme descrito no gráfico a seguir.</span><span class="sxs-lookup"><span data-stu-id="7bf11-183">For a starting point, both developers have synced to the source control repository, as depicted in the following graphic.</span></span>

![Ponto de partida](~/ef6/media/startingpoint.png)

<span data-ttu-id="7bf11-185">O desenvolvedor \#1 e desenvolvedor \#2 agora faz algumas alterações no modelo do EF em sua base de código local.</span><span class="sxs-lookup"><span data-stu-id="7bf11-185">Developer \#1 and developer \#2 now makes some changes to the EF model in their local code base.</span></span> <span data-ttu-id="7bf11-186">O desenvolvedor \#1 adiciona uma propriedade de **classificação** ao **blog** – e gera uma migração **addrating** para aplicar as alterações ao banco de dados.</span><span class="sxs-lookup"><span data-stu-id="7bf11-186">Developer \#1 adds a **Rating** property to **Blog** – and generates an **AddRating** migration to apply the changes to the database.</span></span> <span data-ttu-id="7bf11-187">O desenvolvedor \#2 adiciona uma propriedade **leitores** ao **blog** – e gera a migração de **addreaders** correspondente.</span><span class="sxs-lookup"><span data-stu-id="7bf11-187">Developer \#2 adds a **Readers** property to **Blog** – and generates the corresponding **AddReaders** migration.</span></span> <span data-ttu-id="7bf11-188">Ambos os desenvolvedores executam **Update-Database**, para aplicar as alterações aos seus bancos de dados locais e, em seguida, continuar desenvolvendo o aplicativo.</span><span class="sxs-lookup"><span data-stu-id="7bf11-188">Both developers run **Update-Database**, to apply the changes to their local databases, and then continue developing the application.</span></span>

> [!NOTE]
> <span data-ttu-id="7bf11-189">As migrações são prefixadas com um carimbo de data/hora, portanto, nosso gráfico representa que a migração de addreaders do desenvolvedor \#2 vem após a migração de addrating do desenvolvedor \#1.</span><span class="sxs-lookup"><span data-stu-id="7bf11-189">Migrations are prefixed with a timestamp, so our graphic represents that the AddReaders migration from Developer \#2 comes after the AddRating migration from Developer \#1.</span></span> <span data-ttu-id="7bf11-190">Se o desenvolvedor \#1 ou \#2 gerou a migração, primeiro não faz diferença com os problemas de trabalho em uma equipe, ou o processo para mesclá-los que veremos na próxima seção.</span><span class="sxs-lookup"><span data-stu-id="7bf11-190">Whether developer \#1 or \#2 generated the migration first makes no difference to the issues of working in a team, or the process for merging them that we’ll look at in the next section.</span></span>

![Alterações locais](~/ef6/media/localchanges.png)

<span data-ttu-id="7bf11-192">É um dia de sorte para o desenvolvedor \#1, pois eles acontecem para enviar suas alterações primeiro.</span><span class="sxs-lookup"><span data-stu-id="7bf11-192">It’s a lucky day for Developer \#1 as they happen to submit their changes first.</span></span> <span data-ttu-id="7bf11-193">Como ninguém mais fez check-in porque eles sincronizaram seu repositório, eles podem apenas enviar suas alterações sem executar nenhuma mesclagem.</span><span class="sxs-lookup"><span data-stu-id="7bf11-193">Because no one else has checked in since they synced their repository, they can just submit their changes without performing any merging.</span></span>

![Enviar](~/ef6/media/submit.png)

<span data-ttu-id="7bf11-195">Agora é hora para o desenvolvedor \#2 enviar.</span><span class="sxs-lookup"><span data-stu-id="7bf11-195">Now it’s time for Developer \#2 to submit.</span></span> <span data-ttu-id="7bf11-196">Eles não são tanto sorte.</span><span class="sxs-lookup"><span data-stu-id="7bf11-196">They aren’t so lucky.</span></span> <span data-ttu-id="7bf11-197">Como outra pessoa enviou alterações desde que elas foram sincronizadas, elas precisarão retirar as alterações e mesclar.</span><span class="sxs-lookup"><span data-stu-id="7bf11-197">Because someone else has submitted changes since they synced, they will need to pull down the changes and merge.</span></span> <span data-ttu-id="7bf11-198">O sistema de controle do código-fonte provavelmente será capaz de mesclar automaticamente as alterações no nível de código, pois elas são muito simples.</span><span class="sxs-lookup"><span data-stu-id="7bf11-198">The source control system will likely be able to automatically merge the changes at the code level since they are very simple.</span></span> <span data-ttu-id="7bf11-199">O estado do repositório local do desenvolvedor \#2 após a sincronização é representado no gráfico a seguir.</span><span class="sxs-lookup"><span data-stu-id="7bf11-199">The state of Developer \#2’s local repository after syncing is depicted in the following graphic.</span></span> 

![Recepção](~/ef6/media/pull.png)

<span data-ttu-id="7bf11-201">Neste estágio, o desenvolvedor \#2 pode executar **Update-Database** , que detectará a nova migração **addrating** (que não foi aplicada ao banco de dados do desenvolvedor \#2) e a aplicará.</span><span class="sxs-lookup"><span data-stu-id="7bf11-201">At this stage Developer \#2 can run **Update-Database** which will detect the new **AddRating** migration (which hasn’t been applied to Developer \#2’s database) and apply it.</span></span> <span data-ttu-id="7bf11-202">Agora, a coluna de **classificação** é adicionada à tabela **Blogs** e o banco de dados está em sincronia com o modelo.</span><span class="sxs-lookup"><span data-stu-id="7bf11-202">Now the **Rating** column is added to the **Blogs** table and the database is in sync with the model.</span></span>

<span data-ttu-id="7bf11-203">No entanto, há alguns problemas:</span><span class="sxs-lookup"><span data-stu-id="7bf11-203">There are a couple of problems though:</span></span>

1.  <span data-ttu-id="7bf11-204">Embora **Update-Database** aplique a migração **addrating** , ele também emitirá um aviso: *não é possível atualizar o banco de dados para corresponder ao modelo atual porque há alterações pendentes e a migração automática está desabilitada...*</span><span class="sxs-lookup"><span data-stu-id="7bf11-204">Although **Update-Database** will apply the **AddRating** migration it will also raise a warning: *Unable to update database to match the current model because there are pending changes and automatic migration is disabled…*</span></span>
    <span data-ttu-id="7bf11-205">O problema é que o instantâneo do modelo armazenado na última migração (**Addreader**) não tem a propriedade **rating** no **blog** (pois ele não era parte do modelo quando a migração foi gerada).</span><span class="sxs-lookup"><span data-stu-id="7bf11-205">The problem is that the model snapshot stored in the last migration (**AddReader**) is missing the **Rating** property on **Blog** (since it wasn’t part of the model when the migration was generated).</span></span> <span data-ttu-id="7bf11-206">Code First detecta que o modelo na última migração não corresponde ao modelo atual e gera o aviso.</span><span class="sxs-lookup"><span data-stu-id="7bf11-206">Code First detects that the model in the last migration doesn’t match the current model and raises the warning.</span></span>
2.  <span data-ttu-id="7bf11-207">A execução do aplicativo resultaria em uma InvalidOperationException informando que "*o modelo que está fazendo backup do contexto ' BloggingContext ' foi alterado desde que o banco de dados foi criado. Considere o uso de Migrações do Code First para atualizar o banco de dados... "*</span><span class="sxs-lookup"><span data-stu-id="7bf11-207">Running the application would result in an InvalidOperationException stating that “*The model backing the 'BloggingContext' context has changed since the database was created. Consider using Code First Migrations to update the database…”*</span></span>
    <span data-ttu-id="7bf11-208">Novamente, o problema é que o instantâneo do modelo armazenado na última migração não corresponde ao modelo atual.</span><span class="sxs-lookup"><span data-stu-id="7bf11-208">Again, the problem is the model snapshot stored in the last migration doesn’t match the current model.</span></span>
3.  <span data-ttu-id="7bf11-209">Por fim, esperamos que **a execução de Add-Migration** agora gere uma migração vazia (já que não há nenhuma alteração a ser aplicada ao banco de dados).</span><span class="sxs-lookup"><span data-stu-id="7bf11-209">Finally, we would expect running **Add-Migration** now would generate an empty migration (since there are no changes to apply to the database).</span></span> <span data-ttu-id="7bf11-210">Mas como as migrações comparam o modelo atual com o da última migração (que não tem a propriedade **rating** ), na verdade, ela Scaffold outra chamada **AddColumn** para adicionar na coluna de **classificação** .</span><span class="sxs-lookup"><span data-stu-id="7bf11-210">But because migrations compares the current model to the one from the last migration (which is missing the **Rating** property) it will actually scaffold another **AddColumn** call to add in the **Rating** column.</span></span> <span data-ttu-id="7bf11-211">É claro que essa migração falhará durante **Update-Database** porque a coluna de **classificação** já existe.</span><span class="sxs-lookup"><span data-stu-id="7bf11-211">Of course, this migration would fail during **Update-Database** because the **Rating** column already exists.</span></span>

## <a name="resolving-the-merge-conflict"></a><span data-ttu-id="7bf11-212">Resolvendo o conflito de mesclagem</span><span class="sxs-lookup"><span data-stu-id="7bf11-212">Resolving the merge conflict</span></span>

<span data-ttu-id="7bf11-213">A boa notícia é que não é muito difícil lidar com a mesclagem manualmente – desde que você tenha uma compreensão de como as migrações funcionam.</span><span class="sxs-lookup"><span data-stu-id="7bf11-213">The good news is that it’s not too hard to deal with the merge manually – provided you have an understanding of how migrations works.</span></span> <span data-ttu-id="7bf11-214">Então, se você tiver pulado para esta seção...</span><span class="sxs-lookup"><span data-stu-id="7bf11-214">So if you’ve skipped ahead to this section…</span></span> <span data-ttu-id="7bf11-215">Você precisa voltar e ler o restante do artigo primeiro!</span><span class="sxs-lookup"><span data-stu-id="7bf11-215">sorry, you need to go back and read the rest of the article first!</span></span>

<span data-ttu-id="7bf11-216">Há duas opções, a mais fácil é gerar uma migração em branco que tenha o modelo atual correto como um instantâneo.</span><span class="sxs-lookup"><span data-stu-id="7bf11-216">There are two options, the easiest is to generate a blank migration that has the correct current model as a snapshot.</span></span> <span data-ttu-id="7bf11-217">A segunda opção é atualizar o instantâneo na última migração para ter o instantâneo de modelo correto.</span><span class="sxs-lookup"><span data-stu-id="7bf11-217">The second option is to update the snapshot in the last migration to have the correct model snapshot.</span></span> <span data-ttu-id="7bf11-218">A segunda opção é um pouco mais difícil e não pode ser usada em todos os cenários, mas também é mais limpa porque não envolve a adição de uma migração extra.</span><span class="sxs-lookup"><span data-stu-id="7bf11-218">The second option is a little harder and can’t be used in every scenario, but it’s also cleaner because it doesn’t involve adding an extra migration.</span></span>

### <a name="option-1-add-a-blank-merge-migration"></a><span data-ttu-id="7bf11-219">Opção 1: adicionar uma migração em branco de "mesclagem"</span><span class="sxs-lookup"><span data-stu-id="7bf11-219">Option 1: Add a blank ‘merge’ migration</span></span>

<span data-ttu-id="7bf11-220">Nessa opção, geramos uma migração em branco exclusivamente para fins de garantir que a migração mais recente tenha o instantâneo de modelo correto armazenado nela.</span><span class="sxs-lookup"><span data-stu-id="7bf11-220">In this option we generate a blank migration solely for the purpose of making sure the latest migration has the correct model snapshot stored in it.</span></span>

<span data-ttu-id="7bf11-221">Essa opção pode ser usada independentemente de quem gerou a última migração.</span><span class="sxs-lookup"><span data-stu-id="7bf11-221">This option can be used regardless of who generated the last migration.</span></span> <span data-ttu-id="7bf11-222">No exemplo, estamos seguindo o desenvolvedor \#2 está tomando cuidado com a mesclagem e eles ocorreram para gerar a última migração.</span><span class="sxs-lookup"><span data-stu-id="7bf11-222">In the example we’ve been following Developer \#2 is taking care of the merge and they happened to generate the last migration.</span></span> <span data-ttu-id="7bf11-223">Mas essas mesmas etapas podem ser usadas se o desenvolvedor \#1 gerou a última migração.</span><span class="sxs-lookup"><span data-stu-id="7bf11-223">But these same steps can be used if Developer \#1 generated the last migration.</span></span> <span data-ttu-id="7bf11-224">As etapas também se aplicam se houver várias migrações envolvidas – nós apenas examinamos duas para simplificar.</span><span class="sxs-lookup"><span data-stu-id="7bf11-224">The steps also apply if there are multiple migrations involved – we’ve just been looking at two in order to keep it simple.</span></span>

<span data-ttu-id="7bf11-225">O processo a seguir pode ser usado para essa abordagem, desde o momento em que você perceber que tem alterações que precisam ser sincronizadas do controle do código-fonte.</span><span class="sxs-lookup"><span data-stu-id="7bf11-225">The following process can be used for this approach, starting from the time you realize you have changes that need to be synced from source control.</span></span>

1.  <span data-ttu-id="7bf11-226">Verifique se as alterações de modelo pendentes na sua base de código local foram gravadas em uma migração.</span><span class="sxs-lookup"><span data-stu-id="7bf11-226">Ensure any pending model changes in your local code base have been written to a migration.</span></span> <span data-ttu-id="7bf11-227">Essa etapa garante que você não perca nenhuma alteração legítima quando chegar a hora de gerar a migração em branco.</span><span class="sxs-lookup"><span data-stu-id="7bf11-227">This step ensures you don’t miss any legitimate changes when it comes time to generate the blank migration.</span></span>
2.  <span data-ttu-id="7bf11-228">Sincronizar com controle do código-fonte.</span><span class="sxs-lookup"><span data-stu-id="7bf11-228">Sync with source control.</span></span>
3.  <span data-ttu-id="7bf11-229">Execute **Update-Database** para aplicar as novas migrações nas quais os outros desenvolvedores fizeram check-in.</span><span class="sxs-lookup"><span data-stu-id="7bf11-229">Run **Update-Database** to apply any new migrations that other developers have checked in.</span></span>
    <span data-ttu-id="7bf11-230">**_Observação:_** *se você não receber nenhum aviso do comando Update-Database, não haverá nenhuma nova migração de outros desenvolvedores e não haverá necessidade de realizar nenhuma mesclagem.*</span><span class="sxs-lookup"><span data-stu-id="7bf11-230">**_Note:_** *if you don’t get any warnings from the Update-Database command then there were no new migrations from other developers and there is no need to perform any further merging.*</span></span>
4.  <span data-ttu-id="7bf11-231">Execute **o &lt;de adição de migração\_um nome de\_&gt; – IgnoreChanges** (por exemplo, **Merge-Migrate – IgnoreChanges**).</span><span class="sxs-lookup"><span data-stu-id="7bf11-231">Run **Add-Migration &lt;pick\_a\_name&gt; –IgnoreChanges** (for example, **Add-Migration Merge –IgnoreChanges**).</span></span> <span data-ttu-id="7bf11-232">Isso gera uma migração com todos os metadados (incluindo um instantâneo do modelo atual), mas ignorará as alterações detectadas ao comparar o modelo atual com o instantâneo nas últimas migrações (o que significa que você obtém um método **ativo** e **inativo** ).</span><span class="sxs-lookup"><span data-stu-id="7bf11-232">This generates a migration with all the metadata (including a snapshot of the current model) but will ignore any changes it detects when comparing the current model to the snapshot in the last migrations (meaning you get a blank **Up** and **Down** method).</span></span>
5.  <span data-ttu-id="7bf11-233">Continue desenvolvendo ou envie para o controle do código-fonte (depois de executar os testes de unidade, é claro).</span><span class="sxs-lookup"><span data-stu-id="7bf11-233">Continue developing, or submit to source control (after running your unit tests of course).</span></span>

<span data-ttu-id="7bf11-234">Aqui está o estado da base de código local do desenvolvedor \#2 depois de usar essa abordagem.</span><span class="sxs-lookup"><span data-stu-id="7bf11-234">Here is the state of Developer \#2’s local code base after using this approach.</span></span>

![Migração de mesclagem](~/ef6/media/mergemigration.png)

### <a name="option-2-update-the-model-snapshot-in-the-last-migration"></a><span data-ttu-id="7bf11-236">Opção 2: atualizar o instantâneo do modelo na última migração</span><span class="sxs-lookup"><span data-stu-id="7bf11-236">Option 2: Update the model snapshot in the last migration</span></span>

<span data-ttu-id="7bf11-237">Essa opção é muito semelhante à opção 1, mas remove a migração em branco extra – porque vamos encarar os arquivos de código extras em sua solução.</span><span class="sxs-lookup"><span data-stu-id="7bf11-237">This option is very similar to option 1 but removes the extra blank migration – because let’s face it, who wants extra code files in their solution.</span></span>

<span data-ttu-id="7bf11-238">**Essa abordagem só é viável se a migração mais recente existir apenas na sua base de código local e ainda não tiver sido enviada ao controle do código-fonte (por exemplo, se a última migração foi gerada pelo usuário que faz a mesclagem)** .</span><span class="sxs-lookup"><span data-stu-id="7bf11-238">**This approach is only feasible if the latest migration exists only in your local code base and has not yet been submitted to source control (for example, if the last migration was generated by the user doing the merge)**.</span></span> <span data-ttu-id="7bf11-239">Editar os metadados de migrações que outros desenvolvedores podem já ter aplicado ao seu banco de dados de desenvolvimento, ou ainda pior aplicado a um banco de dados de produção, pode resultar em efeitos colaterais inesperados.</span><span class="sxs-lookup"><span data-stu-id="7bf11-239">Editing the metadata of migrations that other developers may have already applied to their development database – or even worse applied to a production database – can result in unexpected side effects.</span></span> <span data-ttu-id="7bf11-240">Durante o processo, vamos reverter a última migração em nosso banco de dados local e aplicá-la novamente com metadados atualizados.</span><span class="sxs-lookup"><span data-stu-id="7bf11-240">During the process we’re going to roll back the last migration in our local database and re-apply it with updated metadata.</span></span>

<span data-ttu-id="7bf11-241">Embora a última migração precise apenas estar na base de código local, não há restrições para o número ou a ordem das migrações que o executam.</span><span class="sxs-lookup"><span data-stu-id="7bf11-241">While the last migration needs to just be in the local code base there are no restrictions to the number or order of migrations that proceed it.</span></span> <span data-ttu-id="7bf11-242">Pode haver várias migrações de vários desenvolvedores diferentes e as mesmas etapas se aplicam – nós apenas examinamos duas para simplificar.</span><span class="sxs-lookup"><span data-stu-id="7bf11-242">There can be multiple migrations from multiple different developers and the same steps apply– we’ve just been looking at two in order to keep it simple.</span></span>

<span data-ttu-id="7bf11-243">O processo a seguir pode ser usado para essa abordagem, desde o momento em que você perceber que tem alterações que precisam ser sincronizadas do controle do código-fonte.</span><span class="sxs-lookup"><span data-stu-id="7bf11-243">The following process can be used for this approach, starting from the time you realize you have changes that need to be synced from source control.</span></span>

1.  <span data-ttu-id="7bf11-244">Verifique se as alterações de modelo pendentes na sua base de código local foram gravadas em uma migração.</span><span class="sxs-lookup"><span data-stu-id="7bf11-244">Ensure any pending model changes in your local code base have been written to a migration.</span></span> <span data-ttu-id="7bf11-245">Essa etapa garante que você não perca nenhuma alteração legítima quando chegar a hora de gerar a migração em branco.</span><span class="sxs-lookup"><span data-stu-id="7bf11-245">This step ensures you don’t miss any legitimate changes when it comes time to generate the blank migration.</span></span>
2.  <span data-ttu-id="7bf11-246">Sincronizar com o controle do código-fonte.</span><span class="sxs-lookup"><span data-stu-id="7bf11-246">Sync with the source control.</span></span>
3.  <span data-ttu-id="7bf11-247">Execute **Update-Database** para aplicar as novas migrações nas quais os outros desenvolvedores fizeram check-in.</span><span class="sxs-lookup"><span data-stu-id="7bf11-247">Run **Update-Database** to apply any new migrations that other developers have checked in.</span></span>
    <span data-ttu-id="7bf11-248">**_Observação:_** *se você não receber nenhum aviso do comando Update-Database, não haverá nenhuma nova migração de outros desenvolvedores e não haverá necessidade de realizar nenhuma mesclagem.*</span><span class="sxs-lookup"><span data-stu-id="7bf11-248">**_Note:_** *if you don’t get any warnings from the Update-Database command then there were no new migrations from other developers and there is no need to perform any further merging.*</span></span>
4.  <span data-ttu-id="7bf11-249">Execute **Update-Database – TargetMigration &lt;segundo\_última\_&gt;de migração** (no exemplo que estamos seguindo, seria **Update-Database – TargetMigration addrating**).</span><span class="sxs-lookup"><span data-stu-id="7bf11-249">Run **Update-Database –TargetMigration &lt;second\_last\_migration&gt;** (in the example we’ve been following this would be **Update-Database –TargetMigration AddRating**).</span></span> <span data-ttu-id="7bf11-250">Isso faz com que o banco de dados volte para o estado da segunda última migração – efetivamente ' reaplicando ' a última migração do banco de dados.</span><span class="sxs-lookup"><span data-stu-id="7bf11-250">This roles the database back to the state of the second last migration – effectively ‘un-applying’ the last migration from the database.</span></span>
    <span data-ttu-id="7bf11-251">**_Observação:_** *essa etapa é necessária para tornar seguro editar os metadados da migração, já que os metadados também são armazenados no \_\_MigrationsHistoryTable do banco de dados. É por isso que você só deve usar essa opção se a última migração for apenas em sua base de código local. Se outros bancos de dados tiverem a última migração aplicada, você também teria que redistribuí-los e reaplicar a última migração para atualizar os metadados.*</span><span class="sxs-lookup"><span data-stu-id="7bf11-251">**_Note:_** *This step is required to make it safe to edit the metadata of the migration since the metadata is also stored in the \_\_MigrationsHistoryTable of the database. This is why you should only use this option if the last migration is only in your local code base. If other databases had the last migration applied you would also have to roll them back and re-apply the last migration to update the metadata.*</span></span> 
5.  <span data-ttu-id="7bf11-252">Execute **Add-Migration &lt;nome de\_completo\_incluindo\_carimbo de data/hora\_do\_última\_de migração** (no exemplo, estamos seguindo isso seria algo como **Add-migration 201311062215252&gt; addreaders**).\_</span><span class="sxs-lookup"><span data-stu-id="7bf11-252">Run **Add-Migration &lt;full\_name\_including\_timestamp\_of\_last\_migration**&gt; (in the example we’ve been following this would be something like **Add-Migration 201311062215252\_AddReaders**).</span></span>
    <span data-ttu-id="7bf11-253">**_Observação:_** *você precisa incluir o carimbo de data/hora para que as migrações saibam que você deseja editar a migração existente em vez de scaffolding uma nova.*</span><span class="sxs-lookup"><span data-stu-id="7bf11-253">**_Note:_** *You need to include the timestamp so that migrations knows you want to edit the existing migration rather than scaffolding a new one.*</span></span>
    <span data-ttu-id="7bf11-254">Isso atualizará os metadados para a última migração para corresponder ao modelo atual.</span><span class="sxs-lookup"><span data-stu-id="7bf11-254">This will update the metadata for the last migration to match the current model.</span></span> <span data-ttu-id="7bf11-255">Você receberá o seguinte aviso quando o comando for concluído, mas isso é exatamente o que você deseja.</span><span class="sxs-lookup"><span data-stu-id="7bf11-255">You’ll get the following warning when the command completes, but that’s exactly what you want.</span></span> <span data-ttu-id="7bf11-256">"*Somente o código do designer para migração ' 201311062215252\_Addreaders ' foi recom Scaffold. Para rescaffoldr toda a migração, use o parâmetro-Force. "*</span><span class="sxs-lookup"><span data-stu-id="7bf11-256">“*Only the Designer Code for migration '201311062215252\_AddReaders' was re-scaffolded. To re-scaffold the entire migration, use the -Force parameter.”*</span></span>
6.  <span data-ttu-id="7bf11-257">Execute **Update-Database** para aplicar novamente a migração mais recente com os metadados atualizados.</span><span class="sxs-lookup"><span data-stu-id="7bf11-257">Run **Update-Database** to re-apply the latest migration with the updated metadata.</span></span>
7.  <span data-ttu-id="7bf11-258">Continue desenvolvendo ou envie para o controle do código-fonte (depois de executar os testes de unidade, é claro).</span><span class="sxs-lookup"><span data-stu-id="7bf11-258">Continue developing, or submit to source control (after running your unit tests of course).</span></span>

<span data-ttu-id="7bf11-259">Aqui está o estado da base de código local do desenvolvedor \#2 depois de usar essa abordagem.</span><span class="sxs-lookup"><span data-stu-id="7bf11-259">Here is the state of Developer \#2’s local code base after using this approach.</span></span>

![Metadados atualizados](~/ef6/media/updatedmetadata.png)

## <a name="summary"></a><span data-ttu-id="7bf11-261">Resumo</span><span class="sxs-lookup"><span data-stu-id="7bf11-261">Summary</span></span>

<span data-ttu-id="7bf11-262">Há alguns desafios ao usar Migrações do Code First em um ambiente de equipe.</span><span class="sxs-lookup"><span data-stu-id="7bf11-262">There are some challenges when using Code First Migrations in a team environment.</span></span> <span data-ttu-id="7bf11-263">No entanto, uma compreensão básica de como as migrações funciona e algumas abordagens simples para resolver conflitos de mesclagem facilita superar esses desafios.</span><span class="sxs-lookup"><span data-stu-id="7bf11-263">However, a basic understanding of how migrations works and some simple approaches for resolving merge conflicts make it easy to overcome these challenges.</span></span>

<span data-ttu-id="7bf11-264">O problema fundamental são os metadados incorretos armazenados na última migração.</span><span class="sxs-lookup"><span data-stu-id="7bf11-264">The fundamental issue is incorrect metadata stored in the latest migration.</span></span> <span data-ttu-id="7bf11-265">Isso faz com que Code First detecte incorretamente que o modelo atual e o esquema de banco de dados não correspondem e Scaffold o código incorreto na próxima migração.</span><span class="sxs-lookup"><span data-stu-id="7bf11-265">This causes Code First to incorrectly detect that the current model and database schema don’t match and to scaffold incorrect code in the next migration.</span></span> <span data-ttu-id="7bf11-266">Essa situação pode ser superada com a geração de uma migração em branco com o modelo correto ou a atualização dos metadados na migração mais recente.</span><span class="sxs-lookup"><span data-stu-id="7bf11-266">This situation can be overcome by generating a blank migration with the correct model, or updating the metadata in the latest migration.</span></span>
